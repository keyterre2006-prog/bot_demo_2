<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Assistant IA</title>

<style>
:root {
  --bg: #0f0c29;
  --primary: #a855f7;
  --bubble-user: #ffffff;
  --bubble-bot: #2d1b69;
}

body {
  background: var(--bg);
  display: flex; align-items: center; justify-content: center;
  height: 100vh; margin:0;
  font-family: Arial, sans-serif;
  color:white;
}

.container {
  width: 420px;
  background: rgba(255,255,255,0.1);
  padding: 22px;
  border-radius: 14px;
  backdrop-filter: blur(12px);
  box-shadow: 0 0 25px rgba(168,85,247,.4);
}

h2 { text-align: center; margin-top: 0; }

#messages {
  height: 380px;
  overflow-y: auto;
  background: rgba(255,255,255,0.08);
  padding: 12px;
  border-radius: 10px;
  font-size: 14px;
}

.row { display: flex; margin-bottom: 10px; }

.bubble {
  padding: 10px 14px;
  border-radius: 12px;
  max-width: 80%;
  line-height: 1.4;
}

.user { background: var(--bubble-user); color:#111; margin-left:auto; }
.bot { background: var(--bubble-bot); color:white; margin-right:auto; }

/* Animation 3 points */
.typing { display: inline-flex; gap: 4px; padding:10px; }
.dot-anim {
  width: 8px; height: 8px; border-radius: 50%;
  background: var(--primary);
  animation: blink 1.4s infinite both;
}
.dot-anim:nth-child(2){ animation-delay:.2s; }
.dot-anim:nth-child(3){ animation-delay:.4s; }

@keyframes blink {
  0% { opacity:.2; transform: translateY(0); }
  20% { opacity:1; transform: translateY(-3px); }
  100% { opacity:.2; transform: translateY(0); }
}

input, select {
  width: 100%; padding:10px; margin-top:10px;
  border-radius:8px; border:none; outline:none;
}

button {
  width: 100%;
  background: var(--primary);
  color:white;
  font-size:15px;
  padding:10px;
  border:none;
  border-radius: 8px;
  margin-top:10px;
  cursor:pointer;
}

button:hover { opacity: .8; }

</style>
</head>

<body>
<div class="container">
<h2>Assistant IA</h2>

<select id="mode">
  <option value="pro">Pro</option>
  <option value="chaleureux">Chaleureux</option>
  <option value="coach">Coach Business</option>
  <option value="cabinet_osteo">Cabinet OstÃ©o</option>
</select>

<div id="messages"></div>

<input id="input" placeholder="Pose ta question..." />
<button id="send">Envoyer</button>
</div>

<script>
const msgBox = document.getElementById("messages");
const input = document.getElementById("input");
const send = document.getElementById("send");
const modeSelect = document.getElementById("mode");

function addMessage(text, sender="bot") {
  const row = document.createElement("div");
  row.className="row";
  const bubble=document.createElement("div");
  bubble.className=`bubble ${sender}`;
  bubble.innerText=text;
  row.appendChild(bubble);
  msgBox.appendChild(row);
  msgBox.scrollTop=msgBox.scrollHeight;
}

/* Typing animation bubble */
let typingBubble=null;
function showTyping(){
  typingBubble = document.createElement("div");
  typingBubble.className="row";
  const bubble = document.createElement("div");
  bubble.className="bubble bot typing";
  bubble.innerHTML = `
    <span class="dot-anim"></span>
    <span class="dot-anim"></span>
    <span class="dot-anim"></span>
  `;
  typingBubble.appendChild(bubble);
  msgBox.appendChild(typingBubble);
  msgBox.scrollTop=msgBox.scrollHeight;
}

function hideTyping(){
  if(typingBubble){
    typingBubble.remove();
    typingBubble=null;
  }
}

/* Send message */
async function sendMessage(){
  const text = input.value.trim();
  if(!text) return;

  addMessage(text,"user");
  input.value="";

  showTyping();

  const res = await fetch("/api/chat",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ userMessage:text, mode:modeSelect.value })
  });

  hideTyping();

  if(!res.ok){
    addMessage("âš ï¸ Erreur serveur");
    return;
  }

  const data = await res.json();
  addMessage(data.answer);
}

/* Button + Enter */
send.onclick = sendMessage;
input.addEventListener("keypress", e=>{
  if(e.key==="Enter") sendMessage();
});

/* Message d'accueil */
addMessage("ðŸ‘‹ Salut&nbsp;! Je suis ton assistant. Comment puis-je tâ€™aider aujourdâ€™hui ?");
</script>
</body>
</html>
